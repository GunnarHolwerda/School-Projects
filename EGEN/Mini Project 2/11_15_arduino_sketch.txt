/* Current Status
  The sketch currently takes data from sensor, converts to ppt, and sends over Serial
  Conversion is incorrect as the sensor takes water level into account and that needs
  to be factored out.
*/

/*
  Graph
 
 You can use the Arduino serial monitor to view the sent data, or it can
 be read by Processing, PD, Max/MSP, or any other program capable of reading 
 data from a serial port.  The Processing code below graphs the data received 
 so you can see the value of the analog input changing over time.
 
 The circuit:
 The salinity sensor is attached to A5.
*/

//int digitalPin = 19;
float ppt = 0;
float refvoltage = 1.1;

void setup() {
  // Initialize the serial communication:
  Serial.begin(9600);
}

void loop() {
  int samples = 20; //How many times we will read in
  int aRead = 0;
  
  for (int i = 0; i < samples ; i++) 
  {
    aRead += (analogRead(A5));
  }
  
  float voltage = 5.0 * aRead/ (1023 * samples);  // assuming 5V reference 
  
  ppt = 16.3 * voltage;
  
  // convert voltage to ppt
  Serial.print("Analog in reading: ");
  Serial.print(aRead);
  
  // print ppt value on serial monitor
  Serial.print(" - Calculated ppt: ");
  Serial.println(ppt, 2); // the 2 is for 2 decimal places
  delay(1000);
  
  // Wait a bit for the analog-to-digital converter 
  // To stabilize after the last reading:
  delay(2);
}
